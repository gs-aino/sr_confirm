<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>sr_confirm_prototype</title>

  {#    <!-- <link rel="stylesheet" type="text/css" href="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='css/main.css') }}"/>#}
    {#    <link rel="stylesheet" type="text/css" href="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='css/bootstrap.css') }}"/>#}
    {#    <link rel="stylesheet" type="text/css" href="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='css/bootstrap-grid.css') }}"/>#}
    {#    <link rel="stylesheet" type="text/css" href="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='css/bootstrap-reboot.css') }}"/>#}
    {#    <link rel="stylesheet" type="text/css" href="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='css/datatables.css') }}"/>#}
    {#    <script src="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='js/jquery-3.3.1.js') }}"></script>#}
    {#    <script src="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='js/bootstrap.js') }}"></script>#}
    {#    <script src="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='js/bootstrap.bundle.js') }}"></script>#}
    {#    <script src="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='js/datatables.js') }}"></script>#}
    {#    <script src="http://genie.gsshop.com/sr_confirm{{ url_for('static', filename='js/main.js') }}"></script> -->#}

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css')}}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap-grid.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap-reboot.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/datatables.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/amsify.suggestags.css') }}"/>

    <script src="{{ url_for('static', filename='js/jquery-3.3.1.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.js') }}"></script>
    <script src="{{ url_for('static', filename='js/datatables.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.amsify.suggestags.js') }}"></script>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  </head>

  <body>
    <div class="content" id="app">
      <div class="container">
        <div class="row">
          <br><br>
          <div class="row navbar-static-top">
            <h1>sr_confirm_prototype</h1>
          </div>
          <div class="container">
            <table class="table text-center table-striped table-bordered">
              <thead>
                <tr class="">
                  <td class="width: 16%">본문</td>
                  <td class="width: 66%">키워드</td>
                  <td class="width: 30%">결과</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>고객</td>
                  <td>
                    <h4>
                      <input type="text" name="customer" id="customer_tag" value="">
                    </h4>
                  </td>
                  <td rowspan="3">
                    <h6><button type="button" id="first_tag" class="btn btn-secondary btn-lg"></button><span class="first_per"></span></h6>
                    <h6><button type="button" id="second_tag" class="btn btn-secondary btn-lg"></button><span class="second_per"></span></h6>
                    <h6><button type="button" id="third_tag" class="btn btn-secondary btn-lg"></button><span class="third_per"></span></h6>
                  </td>

                </tr>
                <tr>
                  <td>GS</td>
                  <td>
                    <h4>
                      <span class="badge badge-primary">남여공용</span>
                      <span class="badge badge-primary">여유</span>
                      <span class="badge badge-primary">출시</span>
                      <span class="badge badge-primary">중간</span>
                      <span class="badge badge-primary">사이즈</span>
                      <span class="badge badge-primary">크</span>
                      <span class="badge badge-primary">선택</span>
                    </h4>
                  </td>
                </tr>
                <tr>
                  <td>text</td>
                  <td>고객 : &lt;출고완료&gt;&lt;입고택배-택배&gt;&lt;;완전매입상품&gt;사이즈문의<br>GS : 남여공용으로 여유있게 출시 되었으니 중간 사이즈인 경우 크게 선택해주세요</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div>
            <!-- <form action="/upload" method="post" enctype="multipart/form-data" id="upload_form"> -->
            <form action="" method="post" enctype="multipart/form-data" id="upload_form">
              <input type="file" name="userfile" class="file_input"/>
            </form>
            <button class="submit">파일 전송</button>

            <!-- <button class="btn">테스트</button> -->
          </div>

          <sr-component :sr_data="sr_data"></sr-component>
        </div>
      </div>
      <br><br><br>
      <div class="container">
        <h2 class="row text-center">
          <span class="col"><button type="button" class="btn btn-light btn-lg"> << prev </button></span>
          <span class="col"></span>
          <span class="col"><button type="button" class="btn btn-light btn-lg"> >> next </button></span>
        </h2>
      </div>
      <div id="coloured_text" class="display-none"></div>
    </div>
    <template id="srTemplate">
      <table id="example" class="table table-striped">
        <thead>
          <tr>
            <td>sr_no</td>
            <td>sr_cate_b</td>
            <td>sr_cate_m</td>
            <td>sr_cate_s</td>
            <td>sr_text</td>
            <td>act_no</td>
            <td>act_text</td>
            <td>prd_cd</td>
            <td>prd_nm</td>
            <td>prd_desc</td>
            <td>ord_cd</td>
            <td>ord_date</td>
            <td>ord_status</td>
            <td>cust_no</td>
          </tr>
        </thead>
        <tbody>
          <tr class="sr_item" v-for="(data,index) in sr_data" @click="getSRData(data)">
            <td>{% raw %}{{data.sr_no}}{% endraw %}</td>
            <td>{% raw %}{{data.sr_cate_b}}{% endraw %}</td>
            <td>{% raw %}{{data.sr_cate_m}}{% endraw %}</td>
            <td>{% raw %}{{data.sr_cate_s}}{% endraw %}</td>
            <td>{% raw %}{{data.sr_text}}{% endraw %}</td>
            <td>{% raw %}{{data.act_no}}{% endraw %}</td>
            <td>{% raw %}{{data.act_text}}{% endraw %}</td>
            <td>{% raw %}{{data.prd_cd}}{% endraw %}</td>
            <td>{% raw %}{{data.prd_nm}}{% endraw %}</td>
            <td>{% raw %}{{data.prd_desc}}{% endraw %}</td>
            <td>{% raw %}{{data.ord_cd}}{% endraw %}</td>
            <td>{% raw %}{{data.ord_date}}{% endraw %}</td>
            <td>{% raw %}{{data.ord_status}}{% endraw %}</td>
            <td>{% raw %}{{data.cust_no}}{% endraw %}</td>
          </tr>
        </tbody>
      </table>
    </template>

    <script>
    $(document).ready(function(){

      $('#customer_tag').amsifySuggestags({
        type : 'amsify',
        suggestions: []
      });

      clist.sr_data =[{"sr_no":"S079670023","sr_cate_b":"이벤트/프로모션관련","sr_cate_m":"TV쇼핑3회사은품문의","sr_cate_s":"TV쇼핑3회사은품문의","sr_text":"@접수시간 : 2016/05/02 13:59:51@주문상태 : <입금확인>@문의유형 : <상품>@내용 : 4개상품 20만원 이사민데 폴라로이드 카메라 받을수있나요?!","act_no":"A084665817","act_text":"네고객님!취소 상품으로 확인되며, 5월 3회&amp; 20만원 이상 구매시 이벤트는동일 상품으로 3회이상 &amp; 20만원 이상 구매에도 해당되며,단, 5월에 방송된 상품으로만 진행됩니다.  기온의 변덕으로 감기 조심하세요~@12@.","prd_cd":18492958,"prd_nm":"산지애 미시마 10.5kg","prd_desc":"공통,공통,공통,공통","ord_cd":764226793,"ord_date":"20160502","ord_status":"입금확인후취소","cust_no":111111},{"sr_no":"S098157204","sr_cate_b":"상품품질관련","sr_cate_m":"상품품질불만족","sr_cate_s":"기타상품불만족","sr_text":"@접수시간 : 2017/07/28 15:45:35@주문상태 : <배송완료>@문의유형 : <기타 문의>@내용 : 시골에 계신 엄마께 보내드렸는데, 딸이 보내준거라 아무 말씀 없으시다가 아제야 말씀하시네요. 처음에 6개가 썩어서 왔고, 사이즈 작은거는 제가 잘못 선택한거겠죠? 그런데 단맛이 하나도 없다고 하시네요. 딸이 보내준거라 맛 없어도 썩었어도 아까워서 그냥 드신다구요. 날이 너무 더우니 돌아다니시는것도 힘드실것 같아 보내드힘 건데 너무 속상합니다. 7/22일 843054089 ★처리방법 알려주세요  ★반품처리가능한지... 썩은  6개  재발송가능한지요  ?","act_no":"A108280437","act_text":"송금처리하였습니다","prd_cd":21279613,"prd_nm":"딱딱이복숭아 1kg x 4팩","prd_desc":"공통,공통,공통,공통","ord_cd":843054089,"ord_date":"20170722","ord_status":"배송완료","cust_no":111111},{"sr_no":"S081356695","sr_cate_b":"상품품질관련","sr_cate_m":"상품불량","sr_cate_s":"변질","sr_text":"@접수시간 : 2016/06/12 14:05:03@주문상태 : <배송완료>@문의유형 : <반품교환수거>@내용 : 상한 산지애 사과 문의한 사람입니다. 사진 올립니다 빠른 연락바랍니다.","act_no":"A086765855","act_text":"@GS : @고객 : @연락처 : 0113412743  고객님 상품은 18과 보관중 / 2과는 사진 보냈음 (추가 발송)동생꺼도 확인해 보겠음","prd_cd":18538055,"prd_nm":"산지애10.5kg(미시마)+주스9팩","prd_desc":"공통,공통,공통,공통","ord_cd":768485395,"ord_date":"20160525","ord_status":"배송완료","cust_no":111111},{"sr_no":"S096390052","sr_cate_b":"배송관련","sr_cate_m":"배송기사(택배,업체)문의","sr_cate_s":"배송기사문의-고객확인","sr_text":"@고객 : <배송출발><직택배-직반>■택배기사 IN 01051001095 : 방문/ 연락부재-. 보류 01086373772 : 2회부재@GS : 경비실요청","act_no":"A105698369","act_text":"@GS : @고객 : 목요일날 온다더니 벌써 도착했냐. 가서 찾아오겠음.@GS : 금요일 수령확인차 연락드려도 될지?@고객 : 경비실에 맡겼다면서? 지금 가서 찾아오면 됨.@GS : 알겠음. @연락처 : 01086373772@협력사문의/요구사항 :","prd_cd":25499462,"prd_nm":"D_홀베리 애플망고10팩+10팩+3팩","prd_desc":"공통,공통,공통,공통","ord_cd":835774330,"ord_date":"20170612","ord_status":"배송완료","cust_no":111111},{"sr_no":"S114756675","sr_cate_b":"상품품질관련","sr_cate_m":"상품불량","sr_cate_s":"외관불량","sr_text":"@고객 : 고급스러운 포장으로 되어 있어 선물용으로 구입했는데 까만 상처도 있고, 겉부분 흠집도 있고 띠도 없고 이미지처럼 비단천도 없음.  * 불량사진 1688-4549 로 받기로함@GS : 업체로 처리방안 확인후 오늘 18시까지 연락이나 문자@연락처 : 01094479460@협력사문의사항 : 주문번호 918275411- 반품처리방안 답변부탁드립니다","act_no":"A129843457","act_text":"- 업체 02-949-1693 박은미씨 : 부재[12:09][15:18]","prd_cd":15300778,"prd_nm":"나주배 7.5kg 알찬 선물세트","prd_desc":"공통,공통,공통,공통","ord_cd":918275411,"ord_date":"20180916","ord_status":"배송완료","cust_no":111111}];
      console.log(clist.sr_data);

      $('.submit').click(function(){
        var form = $('#upload_form')[0];
        var formData = new FormData(form);
        formData.append("userfile", $(".file_input")[0].files[0]);

        $.ajax({
          url: "{{ url_for('upload') }}",
          processData: false,
          contentType: false,
          data: formData,
          type: 'POST',
          success: function(result){
            let data = JSON.parse(result);
            clist.sr_data = data;
            console.log(data);
          },
          error: function(err){
            console.log(err);
          }
        });

      })

    });


    let clist = new Vue({
      el : "#app",
      data : {
        sr_data : [],
      }
    })

    {#Vue.component('sr-component',{#}
    {#  template : "#srTemplate",#}
    {#  props : ['sr_data'],#}
    {#  methods : {#}
    {#    getSRData : function(data){#}
    {#      let sr_no = data.sr_no;#}
    {#      $.ajax({#}
    {#        url: "{{ url_for('sr_analysis_info') }}",#}
    {#        processData: false,#}
    {#        contentType: false,#}
    {#        type: "POST",#}
    {#        data : `{"sr_no" : ${sr_no}}`,#}
    {#        dataType : 'json',#}
    {#        success: function(data){#}
    {#          setAnalysisBox(data);#}
    {#        },#}
    {#        error: function(err){#}
    {#          console.log('s');#}
    {#          console.log(err);#}
    {#        }#}
    {#      })#}
    {#    }#}
    {#  }#}
    {#});#}

    function setAnalysisBox(data){
      console.log(data);
      $('#first_tag').text(data.tag_first_name);
      $('.first_per').text(data.tag_first_prob);

      $('#second_tag').text(data.tag_second_name);
      $('.second_per').text(data.tag_second_prob);

      $('#third_tag').text(data.tag_third_name);
      $('.third_per').text(data.tag_third_prob);

      let key_arr = data.kwd_cust_origin;
      for(let i = 0; i < key_arr.length; i ++){
        let tag = `<span class="amsify-select-tag col-bg" data-val="${key_arr[i]}">${key_arr[i]}<b class="amsify-remove-tag">✖</b></span>`;
        $('#customer_tag').siblings('.amsify-suggestags-area').find('.amsify-suggestags-input-area-default').prepend(tag);
      }

    }
    </script>

  </body>
  </html>
